# JavaScript SDK

Package: `@rise-maritime/keelson-js` (published to npm). CommonJS output, ES2020 target.

## Structure

### keelson/index.ts
Core SDK module:
- `construct_pubSub_key()`, `construct_rpc_key()`
- `parse_pubsub_key()`, `parse_rpc_key()`, `get_subject_from_pubsub_key()`
- `enclose()`, `uncover()`
- `isSubjectWellKnown()`, `getSubjectSchema()`
- `getProtobufClassFromTypeName()`, `decodePayloadFromTypeName()`, `encodePayloadFromTypeName()`, `encloseFromTypeName()`
- Type: `ParsedPubSubKey` interface

### keelson/index.test.ts
Jest unit tests for the core SDK.

### nodes/
Four Node-RED nodes (each has `.js` + `.html`):
- `keelson-enclose` — wrap payload in Envelope
- `keelson-uncover` — extract payload from Envelope
- `keelson-encode-payload` — encode typed payload to bytes
- `keelson-decode-payload` — decode typed payload from bytes
- `nodes.test.js` — Mocha tests for all nodes

## Generated Code - DO NOT EDIT

Regenerate with `./generate_javascript.sh` (requires `uv sync --group dev` for protoc):
- `keelson/Envelope.ts`
- `keelson/subjects.json` (converted from YAML)
- `keelson/typeRegistry.ts` (ts-proto dynamic encode/decode)
- `keelson/payloads/` (all files)
- `keelson/interfaces/` (all files)
- `keelson/google/` (protobuf well-known types)

## Tests

```bash
cd sdks/js
npm test          # Runs: compile -> jest -> mocha
```

## Key Notes

- Uses `ts-proto` for protobuf codegen (not `protobuf-ts` or `google-protobuf`)
- TypeScript config: `tsconfig.json`, compiled to `dist/`
- `typeRegistry.ts` enables dynamic encode/decode by type name (generated by ts-proto `outputTypeRegistry=true`)
- Dev dependencies include Node-RED 4.0.0 for node testing
