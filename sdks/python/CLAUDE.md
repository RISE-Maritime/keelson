# Python SDK

Package name: `keelson` (published to PyPI). Python >= 3.11.

## Module Map

### keelson/__init__.py
Core SDK. Key construction/parsing, envelope wrapping, subject registry lookup.

- `construct_pubsub_key()`, `construct_rpc_key()`, `construct_liveliness_key()`
- `parse_pubsub_key()`, `parse_rpc_key()`, `parse_liveliness_key()`
- `enclose(payload, enclosed_at)` / `uncover(message)`
- `get_subject_from_pubsub_key()`, `is_subject_well_known()`, `get_subject_schema()`
- `decode_protobuf_payload_from_type_name()`
- `_SUBJECTS` dict loaded from `subjects.yaml`, `_PROTO_TYPES` from descriptor set
- Uses `parse` library for key expression parsing

### keelson/helpers.py
Convenience wrappers for common payload types:
- `enclose_from_bytes()`, `enclose_from_integer()`, `enclose_from_float()`, `enclose_from_string()`
- `enclose_from_lon_lat()`, `enclose_from_timestamp()`

### keelson/codec.py
Zenoh CLI codec implementations (registered as entry points):
- `enclose_from_text()`, `enclose_from_base64()`, `enclose_from_json()`
- `uncover_to_text()`, `uncover_to_base64()`, `uncover_to_json()`

### keelson/scaffolding/
Application scaffolding subpackage. Exports in `scaffolding/__init__.py`:

| Module | Key exports |
|---|---|
| `cli.py` | `add_common_arguments()`, `create_zenoh_config()` |
| `signals.py` | `GracefulShutdown` |
| `liveliness.py` | `LivelinessMonitor`, `declare_liveliness_token()` |
| `queue_utils.py` | `check_queue_backpressure()` |
| `exceptions.py` | `suppress_exception()` |
| `logging.py` | `setup_logging()` |
| `configurable.py` | `make_configurable()` |

## Generated Code - DO NOT EDIT

These are regenerated by `./generate_python.sh`:
- `keelson/Envelope_pb2.py`, `keelson/Envelope_pb2.pyi`
- `keelson/payloads/` (all `*_pb2.py` files + descriptor set)
- `keelson/interfaces/` (all `*_pb2.py` files)
- `keelson/subjects.yaml` (copied from `messages/subjects.yaml`)

The generate script runs `sed` to fix foxglove imports in `payloads/foxglove/*_pb2.py`.

## Tests

```bash
uv run pytest -vv sdks/python/tests/
```

Test files: `test_sdk.py`, `test_helpers.py`, `test_liveliness_wildcards.py`, `test_scaffolding_cli.py`, `test_scaffolding_logging.py`, `test_scaffolding_signals.py`, `test_scaffolding_exceptions.py`, `test_scaffolding_queue_utils.py`

## Entry Points

Registered as `zenoh_cli.codecs.encoders` and `zenoh_cli.codecs.decoders`:
- `keelson-enclose-from-text`, `keelson-enclose-from-base64`, `keelson-enclose-from-json`
- `keelson-uncover-to-text`, `keelson-uncover-to-base64`, `keelson-uncover-to-json`

## Pitfalls

- Connector `bin/` scripts are standalone executables, not importable packages. Use `SourceFileLoader` to import them in tests (see `connectors/CLAUDE.md`).
- If you add exports to scaffolding modules, update `scaffolding/__init__.py` and its `__all__` list.
- `utils.py` is deprecated â€” do not add new code there.
